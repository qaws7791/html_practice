<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      h3 {
        text-transform: capitalize;
      }
      .InputContainer > input {
        display: block;
      }
    </style>
  </head>
  <body onload="load()">
    <div class="slideContainer">
      <input
        type="range"
        min="1"
        max="10"
        value="5"
        class="slider"
        id="myRange"
      />
      <label for="myRange" id="labelRange">5</label>
      <button type="button" id="buttonRange">Start!</button>
    </div>
    <canvas id="myCanvas" width="500" height="500"></canvas>
    <div class="rouletteContainer">
      <h3>current angle: <strong id="currentAngle">0</strong></h3>
      <h3>result angle: <strong id="resultAngle"></strong></h3>
      <h3>result number: <strong id="resultNumber"></strong></h3>
    </div>
    <script>
      var range;
      var labelRange;
      var buttonRange;
      var currentAngle;
      var resultAngle;
      var resultNumber;
      var roulette;
      var ctx;
      var inputContainer;

      function load() {
        ctx = document.getElementById("myCanvas").getContext("2d");
        range = document.getElementById("myRange");
        labelRange = document.getElementById("labelRange");
        buttonRange = document.getElementById("buttonRange");
        currentAngle = document.getElementById("currentAngle");
        resultAngle = document.getElementById("resultAngle");
        resultNumber = document.getElementById("resultNumber");
        inputContainer = document.getElementById("inputContainer");
        roulette = new Roulette();
        roulette.createInput();
        range.oninput = function () {
          labelRange.innerText = range.value;
        };
        buttonRange.onclick = function () {
          roulette.velocity = range.value;
        };
        Update();
      }

      function Roulette() {
        this.current_angle = 0;
        this.velocity = 0;
        this.items = ["A", "B", "C", "D", "E"];
        this.colors = [
          "#f94144",
          "#f3722c",
          "#f8961e",
          "#f9844a",
          "#f9c74f",
          "#90be6d",
          "#43aa8b",
          "#4d908e",
          "#577590",
          "#277da1",
        ];

        this.createInput = function () {
          let Inputs = document.createElement("form");
          Inputs.setAttribute("class", "InputContainer");
          for (let i = 0; i < this.items.length; i++) {
            let newInput = document.createElement("input");
            newInput.setAttribute("type", "text");
            newInput.setAttribute("name", "input_" + i);
            newInput.setAttribute("id", "input_" + i);
            newInput.setAttribute("value", this.items[i]);
            newInput.setAttribute("size", 10);
            newInput.setAttribute("maxlength", 8);
            newInput.oninput = function (e) {
              console.log(e.target.id.slice(6), e.target.value);
              this.items[i] = e.value;
            };
            Inputs.appendChild(newInput);
          }
          document.body.appendChild(Inputs);
        };

        this.animate = function () {
          if (this.velocity > 0.01) this.velocity -= 0.01;
          else {
            //when stopped
            this.velocity = 0;
            resultAngle.innerText = parseInt(this.current_angle);
            resultNumber.innerText =
              this.items.length -
              parseInt(this.current_angle / (360 / this.items.length));
          }
          this.current_angle += this.velocity;
          if (this.current_angle > 360) this.current_angle -= 360;
          else if (this.current_angle < -360) this.current_angle += 360;
          currentAngle.innerText = this.current_angle;
          this.draw(360 / this.items.length);
        };
        this.draw = function (angle) {
          for (let i = 0; i < this.items.length; i++) {
            //arc
            ctx.beginPath();
            ctx.moveTo(300, 300);
            ctx.arc(
              300,
              300,
              200,
              (-90 + this.current_angle + angle * i) * (Math.PI / 180),
              (-90 + this.current_angle + angle * (i + 1)) * (Math.PI / 180),
              false
            );
            ctx.fillStyle = this.colors[i];
            ctx.fill();
            ctx.closePath();

            //text
            ctx.font = "20px serif";
            ctx.translate(300, 300);
            ctx.rotate(
              (-90 + this.current_angle + angle * (i + 0.5)) * (Math.PI / 180)
            );
            ctx.fillStyle = "black";
            ctx.fillText(this.items[i], 60, 10);
            ctx.rotate(
              -(-90 + this.current_angle + angle * (i + 0.5)) * (Math.PI / 180)
            );
            ctx.translate(-300, -300);
          }
          ctx.beginPath();
          ctx.moveTo(290, 80);
          ctx.lineTo(310, 80);
          ctx.lineTo(300, 110);
          ctx.fillStyle = "blue";
          ctx.fill();
          ctx.closePath();
        };
      }

      function Update() {
        ctx.clearRect(0, 0, 700, 700);
        roulette.animate();
        window.requestAnimationFrame(Update);
      }
    </script>
  </body>
</html>
